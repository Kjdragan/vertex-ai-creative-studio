# MCP Imagen-Go Tool (Version: 1.4.4)

This tool provides image generation capabilities using Google's Imagen models (via Vertex AI), integrated into the Model Context Protocol (MCP) GenMedia toolkit. It functions as an MCP server component, allowing LLMs and other MCP clients to generate images from text prompts.

## MCP Tool Definition

The following tool is exposed by this server:

### 1. `imagen_t2i`

*   **Description**: Generate an image with Imagen 3. Options to save to GCS, save locally, or return base64 data.
*   **Handler**: `imagenGenerationHandler` (via wrapper)
*   **Parameters**:
    *   `prompt` (string, required): Prompt for text to image generation.
    *   `model` (string, optional): Model to use for image generation (e.g., "imagen-3.0-generate-002").
        *   Default: `"imagen-3.0-generate-002"`
    *   `num_images` (number, optional): Number of images to generate (1-4).
        *   Default: `1`
        *   Min: `1`, Max: `4`
    *   `aspect_ratio` (string, optional): Aspect ratio of the generated images (e.g., "1:1", "16:9", "9:16").
        *   Default: `"1:1"`
    *   `gcs_bucket_uri` (string, optional): GCS URI prefix to store the generated images (e.g., "your-bucket/outputs/" or "gs://your-bucket/outputs/"). If provided, images are saved to GCS instead of returning bytes directly. Filenames are generated by the API. If this is empty but `GENMEDIA_BUCKET` env var is set, `gs://<GENMEDIA_BUCKET>/imagen_outputs/` will be used.
    *   `output_directory` (string, optional): If provided, specifies a local directory to save the generated image(s) to. If `gcs_bucket_uri` is also set, images will be downloaded from GCS. Filenames will be generated automatically.

## Environment Variable Configuration

The tool utilizes the following environment variables:

*   `PROJECT_ID` (string): **Required**. Your Google Cloud Project ID. The application will terminate if this is not set.
*   `LOCATION` (string): The Google Cloud location/region for Vertex AI services.
    *   Default: `"us-central1"`
*   `GENMEDIA_BUCKET` (string): An optional default Google Cloud Storage bucket to use for GCS outputs if `gcs_bucket_uri` is not specified in the tool request. The path `imagen_outputs/` will be appended to this bucket.
    *   Default: `""` (empty string, meaning no default GCS output path is formed from this variable unless `gcs_bucket_uri` is also absent).
*   `PORT` (string, for HTTP transport): The port for the HTTP server to listen on.
    *   Default: `"8080"`

## Transports Supported

*   `stdio` (default)
*   `sse` (Server-Sent Events)
*   `http` (Streamable HTTP)

CORS is enabled for the HTTP transport, allowing all origins by default.

## Run

Build the tool using `go build` or `go install`.

*   **STDIO (Default)**:
    ```bash
    ./mcp-imagen-go
    # or
    ./mcp-imagen-go -transport stdio
    ```
*   **HTTP**:
    ```bash
    ./mcp-imagen-go -transport http
    # Optionally set PORT environment variable, e.g., PORT=8083 ./mcp-imagen-go -transport http
    ```
    The MCP server will be available at `http://localhost:<PORT>/mcp`.
*   **SSE (Server-Sent Events)**:
    ```bash
    ./mcp-imagen-go -transport sse
    # SSE server typically runs on port 8081 by default in this configuration.
    ```
    The MCP server will be available at `http://localhost:8081`.

## Example

### Imagen Text-to-Image Generation
```json
{
  "method": "tools/call",
  "params": {
    "name": "imagen_t2i",
    "arguments": {
      "prompt": "A photorealistic image of a cat wearing a small wizard hat, sitting on a pile of ancient books.",
      "model": "imagen-3.0-generate-002",
      "num_images": 1,
      "aspect_ratio": "1:1",
      "output_directory": "./imagen_output"
    }
  }
}
```
